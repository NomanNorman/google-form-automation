<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Form Automation</title>
    <script>
        async function fetchAnswersFromGemini(formLink) {
            // Fetch answers from Gemini API
            const response = await fetch('https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer AIzaSyCGppnTpCrOYAC-UNizx1KcZVMgOK3zoZs`
                },
                body: JSON.stringify({ prompt: formLink })
            });
            const data = await response.json();
            return data.responses; // Adjust according to the actual response structure
        }

        function cleanText(text) {
            return text
                .replace(/^\d+\.\s*|\s*\d+\s*|\s*[\d]+\.\s*/g, '') // Remove serial numbers
                .replace(/[\*\(\)]/g, '') // Remove asterisks and parentheses
                .trim(); // Trim leading and trailing whitespace
        }

        async function fillAnswers(formLink) {
            const answers = await fetchAnswersFromGemini(formLink);
            console.log('Fetched answers:', answers);

            // Fill answers in the form
            answers.forEach(answer => {
                const cleanedAnswer = cleanText(answer); // Clean the answer

                const questionElements = document.querySelectorAll('div.geS5n');
                questionElements.forEach((questionElement, index) => {
                    const optionElements = questionElement.querySelectorAll('div.AB7Lab.Id5V1');
                    optionElements.forEach(optionElement => {
                        const label = optionElement.closest('label');
                        if (label) {
                            const labelText = cleanText(label.innerText); // Clean the label text
                            if (labelText === cleanedAnswer) {
                                label.click(); // Select the correct option
                            }
                        }
                    });
                });
            });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const formLink = urlParams.get('formLink');
            if (formLink) {
                // Redirect to the form URL
                window.location.href = formLink;

                // Wait for form to load and fill answers
                window.addEventListener('load', async () => {
                    await fillAnswers(formLink);
                });
            }
        });
    </script>
</head>
<body>
    <h1>Google Form Automation</h1>
</body>
</html>
